!function(){"use strict";var t,e,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(){return a=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},a.apply(this,arguments)},i=function(t){return function(e){return a=typeof(n=e),(null===n?"null":"object"===a&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===a&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":a)===t;var n,a}},r=function(t){return function(e){return typeof e===t}},o=i("string"),l=i("object"),s=i("array"),c=(t=null,function(e){return t===e}),u=r("boolean"),m=r("number"),d=function(){},g=function(t){return function(){return t}},f=g(!1),p=g(!0),h=function(){return b},b=function(){var t=function(t){return t.isNone()},e=function(t){return t()},n=function(t){return t};return{fold:function(t,e){return t()},is:f,isSome:f,isNone:p,getOr:n,getOrThunk:e,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:g(null),getOrUndefined:g(void 0),or:n,orThunk:e,map:h,each:d,bind:h,exists:f,forall:p,filter:h,equals:t,equals_:t,toArray:function(){return[]},toString:g("none()")}}(),v=function(t){var e=g(t),n=function(){return i},a=function(e){return e(t)},i={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:p,isNone:f,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return v(e(t))},each:function(e){e(t)},bind:a,exists:a,forall:a,filter:function(e){return e(t)?i:b},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(f,(function(e){return n(t,e)}))}};return i},y={some:v,none:h,from:function(t){return null==t?b:v(t)}},_=Array.prototype.push,w=function(t){for(var e=[],n=0,a=t.length;n<a;++n){if(!s(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);_.apply(e,t[n])}return e},D=("undefined"!=typeof window?window:Function("return this;")(),function(t,e,n){!function(t,e,n){if(!(o(n)||u(n)||m(n)))throw new Error("Attribute value was not simple");t.setAttribute(e,n+"")}(t.dom,e,n)}),x=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},A={fromHtml:function(t,e){var n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||n.childNodes.length>1)throw new Error("HTML must have a single root node");return x(n.childNodes[0])},fromTag:function(t,e){var n=(e||document).createElement(t);return x(n)},fromText:function(t,e){var n=(e||document).createTextNode(t);return x(n)},fromDom:x,fromPoint:function(t,e,n){return y.from(t.dom.elementFromPoint(e,n)).map(x)}},C=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),S=tinymce.util.Tools.resolve("tinymce.util.Promise"),T=tinymce.util.Tools.resolve("tinymce.util.XHR"),O=function(t){return t.getParam("image_dimensions",!0,"boolean")},U=function(t){return t.getParam("image_class_list")},I=function(t){return t.getParam("images_upload_url","","string")},N=function(t){return t.getParam("images_upload_handler",void 0,"function")},P=function(t,e){return Math.max(parseInt(t,10),parseInt(e,10))},L=function(t){return t&&(t=t.replace(/px$/,"")),t},k=function(t){return t.length>0&&/^[0-9]+$/.test(t)&&(t+="px"),t},E=function(t){if(t.margin){var e=String(t.margin).split(" ");switch(e.length){case 1:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[0],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[0];break;case 2:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[1];break;case 3:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[1];break;case 4:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[3]}delete t.margin}return t},M=function(t){var e={"image-400":{width:"400",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-500":{width:"500",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-600":{width:"600",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-full":{width:"",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-400-gray":{width:"400",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-500-gray":{width:"500",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-600-gray":{width:"600",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-full-gray":{width:"",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"},"image-custom-gray":{width:"",height:"",align:"align-center",style:"display: block; margin-left: auto; margin-right: auto;"}};return null!=t?e[t]:e},R=function(t){return"IMG"===t.nodeName&&(t.hasAttribute("data-mce-object")||t.hasAttribute("data-mce-placeholder"))},z=C.DOM,j=function(t){return t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?L(t.style.marginLeft):""},H=function(t){return t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?L(t.style.marginTop):""},B=function(t){return t.style.borderWidth?L(t.style.borderWidth):""},F=function(t,e){return t.hasAttribute(e)?t.getAttribute(e):""},G=function(t,e){return t.style[e]?t.style[e]:""},W=function(t){return null!==t.parentNode&&"FIGURE"===t.parentNode.nodeName},q=function(t,e,n){""===n?t.removeAttribute(e):t.setAttribute(e,n)},$=function(t,e){W(t)?function(t){var e=t.parentNode;z.insertAfter(t,e),z.remove(e)}(t):function(t,e){var n=null!=e?"image".concat(" ",e):"image",a=z.create("figure",{class:n});z.insertAfter(a,t),a.appendChild(t),a.appendChild(z.create("figcaption",{contentEditable:"true"},"Caption")),a.contentEditable="false",a.setAttribute("copyright",window.location.host)}(t,e)},J=function(t,e){var n=t.getAttribute("style"),a=e(null!==n?n:"");a.length>0?(t.setAttribute("style",a),t.setAttribute("data-mce-style",a)):t.removeAttribute("style")},X=function(t,e){return function(t,n,a){t.style[n]?(t.style[n]=k(a),J(t,e)):q(t,n,a)}},V=function(t,e){return t.style[e]?L(t.style[e]):F(t,e)},Z=function(t,e){var n=k(e);t.style.marginLeft=n,t.style.marginRight=n},K=function(t,e){var n=k(e);t.style.marginTop=n,t.style.marginBottom=n},Q=function(t,e){var n=k(e);t.style.borderWidth=n},Y=function(t,e){t.style.borderStyle=e},tt=function(t){return"FIGURE"===t.nodeName},et=function(t){return 0===z.getAttrib(t,"alt").length&&"presentation"===z.getAttrib(t,"role")},nt=function(t){return 0!==z.getAttrib(t,"data-allow-ads").length},at=function(t){return et(t)?"":F(t,"alt")},it=function(t){var e=z.getParent(t,"figure.image"),n=null!=e?e.getElementsByTagName("figcaption"):null;return null!=n&&n.length?n[0].textContent:""},rt=function(t,e){var n=document.createElement("img");return q(n,"style",e.style),(j(n)||""!==e.hspace)&&Z(n,e.hspace),(H(n)||""!==e.vspace)&&K(n,e.vspace),(B(n)||""!==e.border)&&Q(n,e.border),(function(t){return G(t,"borderStyle")}(n)||""!==e.borderStyle)&&Y(n,e.borderStyle),t(n.getAttribute("style"))},ot=function(t){var e="align-none",n=""==t.class||null==t.class?t.class_list_default:t.class;if(null!=n&&""!=n){var a=M(n);e="object"==typeof a?a.align+" "+n:t.class}return e=(e=e.trim()).replace(/\s{2,}/g," ")},lt=function(t,e){return{src:F(e,"src"),alt:at(e),title:F(e,"title"),width:V(e,"width"),height:V(e,"height"),class:F(e,"class"),style:t(F(e,"style")),caption:W(e),allow_ads:nt(e),caption_text:it(e),hspace:j(e),vspace:H(e),border:B(e),borderStyle:G(e,"borderStyle"),isDecorative:et(e)}},st=function(t,e,n,a,i){n[a]!==e[a]&&i(t,a,n[a])},ct=function(t,e,n){if(n){z.setAttrib(t,"role","presentation");var a=A.fromDom(t);D(a,"alt","")}else{if(c(e)){a=A.fromDom(t);i="alt",a.dom.removeAttribute(i)}else{a=A.fromDom(t);D(a,"alt",e)}"presentation"===z.getAttrib(t,"role")&&z.setAttrib(t,"role","")}var i},ut=function(t,e){return function(n,a,i){t(n,i),J(n,e)}},mt=function(t,e,n){var a=lt(t,n);st(n,a,e,"caption",(function(t,n,a){$(t,e.figure_classes)})),st(n,a,e,"src",q),st(n,a,e,"title",q),st(n,a,e,"width",X(0,t)),st(n,a,e,"height",X(0,t)),st(n,a,e,"class",ut((function(t,e){return q(t,"class",e)}),t)),st(n,a,e,"style",ut((function(t,e){return q(t,"style",e)}),t)),st(n,a,e,"hspace",ut(Z,t)),st(n,a,e,"vspace",ut(K,t)),st(n,a,e,"border",ut(Q,t)),st(n,a,e,"borderStyle",ut(Y,t)),function(t,e,n){n.alt===e.alt&&n.isDecorative===e.isDecorative||ct(t,n.alt,n.isDecorative)}(n,a,e),function(t,e,n){n.caption_text,e.caption_text}(0,a,e),function(t,e,n){n.allow_ads?z.setAttrib(t,"data-allow-ads","true"):z.setAttrib(t,"data-allow-ads","")}(n,0,e)},dt=function(t,e){var n=t.dom.styles.parse(e),a=E(n),i=t.dom.styles.parse(t.dom.styles.serialize(a));return t.dom.styles.serialize(i)},gt=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return n?t.dom.select("img",n)[0]:e&&("IMG"!==e.nodeName||R(e))?null:e},ft=function(t,e){var n=t.dom,a=n.getParent(e.parentNode,(function(e){return!!t.schema.getTextBlockElements()[e.nodeName]}),t.getBody());return a?n.split(a,e):e},pt=function(t,e){var n=ot(e),i=function(t,e){var n=document.createElement("img"),i=M(e.class);if("object"==typeof i&&(e.style=i.style),mt(t,a(a({},e),{caption:!1}),n),ct(n,e.alt,e.isDecorative),e.caption){var r=z.create("figure",{class:"image"}),o=""==e.caption_text?"":e.caption_text;return r.appendChild(n),r.appendChild(z.create("figcaption",{contentEditable:"true"},o)),r.contentEditable="false",r.setAttribute("copyright",window.location.host),r}return n}((function(e){return dt(t,e)}),e);t.dom.setAttrib(i,"data-mce-id","__mcenew"),t.focus(),t.selection.setContent(i.outerHTML);var r=t.dom.select('*[data-mce-id="__mcenew"]')[0];if(t.dom.setAttrib(r,"data-mce-id",null),tt(r)){"align-none"==n?(t.dom.removeClass(r,"align-center"),t.dom.removeClass(r,"align-left"),t.dom.removeClass(r,"align-right")):t.dom.addClass(r,n,null);var o=ft(t,r);t.selection.select(o)}else t.selection.select(r)},ht=function(t,e){var n=gt(t);if(mt((function(e){return dt(t,e)}),e,n),function(t,e){t.dom.setAttrib(e,"src",e.getAttribute("src"))}(t,n),tt(n.parentNode)){var a=n.parentNode,i=ot(e);!function(t,e){if(!c(e))for(var n=t.firstChild;n;)"figcaption"==n.nodeName.toLowerCase()&&(n.innerHTML=e),n=n.nextSibling}(a,e.caption_text),function(t,e,n){if(!c(e)){var a=z.getAttrib(t,"class"),i=U(n);i.length&&i.map((function(e){a.includes(e.value)&&z.removeClass(t,e.value)})),z.addClass(t,e)}}(a,e.class,t),ft(t,a),"align-none"==i?(t.dom.removeClass(a,"align-center"),t.dom.removeClass(a,"align-left"),t.dom.removeClass(a,"align-right")):t.dom.addClass(a,i,null),t.selection.select(n.parentNode)}else{var r=M(e.class);"object"==typeof r&&n.classList.add(r.align),t.selection.select(n),function(t,e,n){var a=function(){n.onload=n.onerror=null,t.selection&&(t.selection.select(n),t.nodeChanged())};n.onload=function(){e.width||e.height||!O(t)||t.dom.setAttribs(n,{width:String(n.clientWidth),height:String(n.clientHeight)}),a()},n.onerror=a}(t,e,n)}},bt=Object.prototype.hasOwnProperty,vt=(e=function(t,e){return l(t)&&l(e)?vt(t,e):e},function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var a={},i=0;i<t.length;i++){var r=t[i];for(var o in r)bt.call(r,o)&&(a[o]=e(a[o],r[o]))}return a}),yt=tinymce.util.Tools.resolve("tinymce.util.Tools"),_t=function(t){return o(t.value)?t.value:""},wt=function(t,e){var n=[];return yt.each(t,(function(t){var a=o(t.text)?t.text:o(t.title)?t.title:"";if(void 0!==t.menu){var i=wt(t.menu,e);n.push({text:a,items:i})}else{var r=e(t);n.push({text:a,value:r})}})),n},Dt=function(t){return void 0===t&&(t=_t),function(e){return e?y.from(e).map((function(e){return wt(e,t)})):y.none()}},xt=function(t,e){var n=c(e)?[]:e.split(" ");return function(t,e){for(var n=0;n<t.length;n++){var a=e(t[n],n);if(a.isSome())return a}return y.none()}(t,(function(t){return function(t){return Object.prototype.hasOwnProperty.call(t,"items")}(t)?xt(t.items,e):t.value===e?y.some(t):n.length&&n.includes(t.value)?void y.some(t):y.none()}))},At=Dt,Ct=function(t){return Dt(_t)(t)},St=function(t,e){return t.bind((function(t){return xt(t,e)}))};function Tt(t){var e=function(e,n,a,i,r){var o=new XMLHttpRequest;o.open("POST",t.url),o.withCredentials=t.credentials,o.upload.onprogress=function(t){i(t.loaded/t.total*100)},o.onerror=function(){a("Image upload failed due to a XHR Transport error. Code: "+o.status)},o.onload=function(){if(o.status<200||o.status>=300)a("HTTP Error: "+o.status);else{var e,i,r=JSON.parse(o.responseText);if(r&&"string"==typeof r.location)n((e=t.basePath,i=r.location,e?e.replace(/\/$/,"")+"/"+i.replace(/^\//,""):i));else a("Invalid JSON: "+o.responseText)}};var l=new FormData;l.append("file",e.blob(),e.filename()),l.append("filedesc",t.filedesc),o.send(l)};return t=yt.extend({credentials:!1,handler:e},t),{upload:function(n){return t.url||t.handler!==e?function(t,e,n){return new S((function(a,i){try{e(t,a,i,d,n)}catch(t){i(t.message)}}))}(n,t.handler,t.filedesc):S.reject("Upload url missing from the settings.")}}}var Ot=function(t){return{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"listbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]},{type:"checkbox",label:"Allow Ads",name:"allow_ads",checked:!1}]}},Ut=function(t){var e=At((function(e){return t.convertURL(e.value||e.url,"src")})),n=new S((function(n){!function(t,e){var n=function(t){return t.getParam("image_list",!1)}(t);"string"==typeof n?T.send({url:n,success:function(t){e(JSON.parse(t))}}):"function"==typeof n?n(e):e(n)}(t,(function(t){n(e(t).map((function(t){return w([[{text:"None",value:""}],t])})))}))})),a=Ct(U(t)),i=function(t){return t.getParam("image_class_list_default")}(t),r=function(t){return t.getParam("image_advtab",!1,"boolean")}(t),l=function(t){return t.getParam("image_uploadtab",!0,"boolean")}(t),s=function(t){return!!I(t)}(t),c=function(t){return!!N(t)}(t),u=function(t){var e=gt(t);return e?lt((function(e){return dt(t,e)}),e):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!0,caption_text:"",allow_ads:!0,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1,class_list_default:"image-full-gray"}}(t),m=function(t){return t.getParam("image_description",!0,"boolean")}(t),d=function(t){return t.getParam("image_title",!1,"boolean")}(t),g=O(t),f=function(t){return t.getParam("image_caption",!1,"boolean")}(t),p=function(t){return t.getParam("a11y_advanced_options",!1,"boolean")}(t),h=function(t){return t.getParam("image_allow_ads",!1,"boolean")}(t),b=I(t),v=function(t){return t.getParam("images_upload_base_path",void 0,"string")}(t),_=function(t){return t.getParam("images_upload_credentials",!1,"boolean")}(t),D=N(t),x=function(t){return t.getParam("automatic_uploads",!0,"boolean")}(t),A=y.some(function(t){return t.getParam("image_prepend_url","","string")}(t)).filter((function(t){return o(t)&&t.length>0}));return n.then((function(t){return{image:u,imageList:t,classList:a,classListDefault:i,hasAdvTab:r,hasUploadTab:l,hasUploadUrl:s,hasUploadHandler:c,hasDescription:m,hasImageTitle:d,hasDimensions:g,hasImageCaption:f,hasImageAllowAds:h,url:b,basePath:v,credentials:_,handler:D,prependURL:A,hasAccessibilityOptions:p,automaticUploads:x}}))},It=function(t){var e=t.imageList.map((function(t){return{name:"images",type:"listbox",label:"Image list",items:t}})),n={name:"alt",type:"input",label:"Alternative description",disabled:t.hasAccessibilityOptions&&t.image.isDecorative},a={name:"caption_text",type:"input",label:"Caption",disabled:t.hasAccessibilityOptions&&t.image.isDecorative},i=t.classList.map((function(t){return{name:"classes",type:"listbox",label:"Class",items:t}}));return w([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],e.toArray(),t.hasAccessibilityOptions&&t.hasDescription?[{type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]}]:[],t.hasDescription?[n]:[],t.hasImageCaption?[a]:[],t.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],t.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[{type:"button",text:"Restore original size",primary:!1,name:"restore_size"}],[{type:"grid",columns:2,items:w([i.toArray(),t.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])}]])},Nt=function(t){return{title:"General",name:"general",items:It(t)}},Pt=It,Lt=function(t){return{title:"Upload",name:"upload",items:[{type:"textarea",name:"filedesc",label:"Mô tả ảnh"},{type:"dropzone",name:"fileinput"}]}},kt=function(t){var e=o(t.class)?t.class.split(" "):[];if(e.length){var n=M();e.forEach(((e,a)=>{Object.hasOwnProperty.call(n,e)&&(t.class=e)}))}return{src:{value:t.src,meta:{}},images:t.src,alt:t.alt,title:t.title,dimensions:{width:t.width,height:t.height},classes:t.class,caption:!!t.caption_text&&t.caption,caption_text:t.caption_text,style:t.style,vspace:t.vspace,border:t.border,hspace:t.hspace,borderstyle:t.borderStyle,fileinput:[],isDecorative:t.isDecorative,figure_class:t.figure_class,allow_ads:t.allow_ads,class_list_default:t.class_list_default}},Et=function(t,e){return{src:t.src.value,alt:0===t.alt.length&&e?null:t.alt,title:t.title,width:t.dimensions.width,height:t.dimensions.height,class:t.classes,style:t.style,caption:t.caption,caption_text:t.caption_text,hspace:t.hspace,vspace:t.vspace,border:t.border,borderStyle:t.borderstyle,isDecorative:t.isDecorative,figure_class:t.figure_class,allow_ads:t.allow_ads,class_list_default:t.class_list_default}},Mt=function(t,e){var n=e.getData();(function(t,e){return/^(?:[a-zA-Z]+:)?\/\//.test(e)?y.none():t.prependURL.bind((function(t){return e.substring(0,t.length)!==t?y.some(t+e):y.none()}))})(t,n.src.value).each((function(t){e.setData({src:{value:t,meta:n.src.meta}})}))},Rt=function(t,e){var n=e.getData(),a=n.src.meta;if(void 0!==a){var i=vt({},n);!function(t,e,n){t.hasDescription&&o(n.alt)&&(e.alt=n.alt),t.hasImageCaption&&o(n.caption_text)&&(e.caption_text=n.caption_text),t.hasAccessibilityOptions&&(e.isDecorative=n.isDecorative||e.isDecorative||!1),t.hasImageTitle&&o(n.title)&&(e.title=n.title),t.hasDimensions&&(o(n.width)&&(e.dimensions.width=n.width),o(n.height)&&(e.dimensions.height=n.height)),t.class_list_default&&o(n.class_list_default)&&(e.class=n.class_list_default),o(n.class)&&St(t.classList,n.class).each((function(t){e.classes=t.value})),t.hasImageCaption&&u(n.caption)&&(e.caption=n.caption),t.hasAdvTab&&(o(n.style)&&(e.style=n.style),o(n.vspace)&&(e.vspace=n.vspace),o(n.border)&&(e.border=n.border),o(n.hspace)&&(e.hspace=n.hspace),o(n.borderstyle)&&(e.borderstyle=n.borderstyle),o(n.borderstyle)&&(e.borderstyle=n.borderstyle))}(t,i,a),e.setData(i)}},zt=function(t,e,n,a){var i=a.getData(),r=i.src.value,o=i.src.meta||{};o.width||o.height||!e.hasDimensions||t.imageSize(r).then((function(t){n.open&&a.setData({dimensions:t})}))},jt=function(t,e,n,a){Mt(e,a),Rt(e,a),zt(t,e,n,a),function(t,e,n){var a=n.getData(),i=St(t.imageList,a.src.value);e.prevImage=i,n.setData({images:i.map((function(t){return t.value})).getOr("")})}(e,n,a),function(t,e,n){n.getData(),St(t.classList,""),n.setData({classes:""})}(e,0,a),a.showTab("general")},Ht=function(t,e,n){var a=E(t(n.style)),i=vt({},n);return i.vspace=function(t){return t["margin-top"]&&t["margin-bottom"]&&t["margin-top"]===t["margin-bottom"]?L(String(t["margin-top"])):""}(a),i.hspace=function(t){return t["margin-right"]&&t["margin-left"]&&t["margin-right"]===t["margin-left"]?L(String(t["margin-right"])):""}(a),i.border=function(t){return t["border-width"]?L(String(t["border-width"])):""}(a),i.borderstyle=function(t){return t["border-style"]?String(t["border-style"]):""}(a),i.style=function(t,e,n){return e(t(e(n)))}(t,e,a),i},Bt=function(t,e,n,a){var i,r=a.getData();a.block("Uploading image"),(i=r.fileinput,0===i.length?y.none():y.some(i[0])).fold((function(){a.unblock()}),(function(i){var o,l=URL.createObjectURL(i),s=Tt({url:e.url,basePath:e.basePath,credentials:e.credentials,handler:e.handler,filedesc:r.filedesc}),c=function(){a.unblock(),a.setData({filedesc:""}),URL.revokeObjectURL(l)},u=function(i,r){r=r.replace(/(\r\n|\n|\r)/gm,"");a.setData({src:{value:i,meta:{alt:r,caption_text:r,caption:!0}}}),a.showTab("general"),jt(t,e,n,a)};(o=i,new S((function(t,e){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=function(){e(n.error.message)},n.readAsDataURL(o)}))).then((function(n){var o=t.createBlobCache(i,l,n);e.automaticUploads?s.upload(o).then((function(t,e){u(t,r.filedesc),c()})).catch((function(e){c(),t.alertErr(e)})):(t.addToBlobCache(o),u(o.blobUri(),r.filedesc),a.unblock())}))}))},Ft=function(t,e,n){return function(a,i){"src"===i.name?jt(t,e,n,a):"images"===i.name?function(t,e,n,a){var i=a.getData(),r=St(e.imageList,i.images);r.each((function(t){var e=""===i.alt||n.prevImage.map((function(t){return t.text===i.alt})).getOr(!1);e?""===t.value?a.setData({src:t,alt:n.prevAlt}):a.setData({src:t,alt:t.text}):a.setData({src:t})})),n.prevImage=r,jt(t,e,n,a)}(t,e,n,a):"classes"===i.name?function(t,e,n,a){var i=a.getData();if(""!=i.src.value){var r=M(i.classes),o=""==r||null==r?"":"align-center";a.setData({dimensions:{width:null!=r?r.width:i.dimensions.width,height:null!=r?r.height:i.dimensions.height},caption:i.caption,caption_text:""==i.caption_text&&i.caption?"Chú thích ảnh":i.caption_text,figure_classes:o})}Rt(e,a)}(0,e,0,a):"alt"===i.name?n.prevAlt=a.getData().alt:"caption_text"===i.name?(n.prevCaptionText=a.getData().caption_text,function(t,e,n,a){var i=a.getData();a.setData({caption_text:i.caption_text}),a.setData({caption:!!i.caption_text});var r=a.getData();st(e.image,i,r,"caption",(function(t,e,n){}))}(0,e,0,a)):"style"===i.name?function(t,e){var n=e.getData(),a=Ht(t.parseStyle,t.serializeStyle,n);e.setData(a)}(t,a):"vspace"===i.name||"hspace"===i.name||"border"===i.name||"borderstyle"===i.name?function(t,e,n){var a=vt(kt(e.image),n.getData()),i=rt(t.normalizeCss,Et(a,!1));n.setData({style:i})}(t,e,a):"fileinput"===i.name?Bt(t,e,n,a):"filedesc"===i.name?function(t,e,n,a){var i=a.getData();a.setData({filedesc:i.filedesc})}(0,0,0,a):"isDecorative"===i.name&&(a.getData().isDecorative?a.disable("alt"):a.enable("alt"))}},Gt=function(t){return function(){t.open=!1}},Wt=function(t){return t.hasAdvTab||t.hasUploadUrl||t.hasUploadHandler?{type:"tabpanel",tabs:w([[Nt(t)],t.hasUploadTab&&(t.hasUploadUrl||t.hasUploadHandler)?[Lt(t)]:[],t.hasAdvTab?[Ot(t)]:[]])}:{type:"panel",items:Pt(t)}},qt=function(t){return function(e){var n=function(t){return{prevImage:St(t.imageList,t.image.src),prevAlt:t.image.alt,prevCaptionText:t.image.caption_text,open:!0}}(e);return{title:"Insert/Edit Image",size:"normal",body:Wt(e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:kt(e.image),onSubmit:t.onSubmit(e),onChange:Ft(t,e,n),onAction:function(a,i){"restore_size"==i.name&&function(t,e,n,a){a.getData().src.meta,zt(t,e,n,a)}(t,e,n,a)},onClose:Gt(n)}}},$t=function(t){return function(e){return function(n){var a=vt(kt(e.image),n.getData());t.execCommand("mceUpdateImage",!1,Et(a,e.hasAccessibilityOptions)),t.editorUpload.uploadImagesAuto(),n.close()}}},Jt=function(t){return function(e){return function(t){return new S((function(e){var n=document.createElement("img"),a=function(t){n.parentNode&&n.parentNode.removeChild(n),e(t)};n.onload=function(){var t={width:P(n.width,n.clientWidth),height:P(n.height,n.clientHeight)};a(S.resolve(t))},n.onerror=function(){a(S.reject("Failed to get image dimensions for: "+t))};var i=n.style;i.visibility="hidden",i.position="fixed",i.bottom=i.left="0px",i.width=i.height="auto",document.body.appendChild(n),n.src=t}))}(t.documentBaseURI.toAbsolute(e)).then((function(t){return{width:String(t.width),height:String(t.height)}}))}},Xt=function(t){return function(e,n,a){return t.editorUpload.blobCache.create({blob:e,blobUri:n,name:e.name?e.name.replace(/\.[^\.]+$/,""):null,base64:a.split(",")[1]})}},Vt=function(t){return function(e){t.editorUpload.blobCache.add(e)}},Zt=function(t){return function(e){t.windowManager.alert(e)}},Kt=function(t){return function(e){return dt(t,e)}},Qt=function(t){return function(e){return t.dom.parseStyle(e)}},Yt=function(t){return function(e,n){return t.dom.serializeStyle(e,n)}},te=function(t){var e={onSubmit:$t(t),imageSize:Jt(t),addToBlobCache:Vt(t),createBlobCache:Xt(t),alertErr:Zt(t),normalizeCss:Kt(t),parseStyle:Qt(t),serializeStyle:Yt(t)};return{open:function(){Ut(t).then(qt(e)).then(t.windowManager.open)}}},ee=function(t){t.addCommand("mceImage",te(t).open),t.addCommand("mceUpdateImage",(function(e,n){t.undoManager.transact((function(){return function(t,e){var n=gt(t);if(n){var i=lt((function(e){return dt(t,e)}),n),r=a(a({},i),e);r.src?ht(t,r):function(t,e){if(e){var n=t.dom.is(e.parentNode,"figure.image")?e.parentNode:e;t.dom.remove(n),t.focus(),t.nodeChanged(),t.dom.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())}}(t,n)}else e.src&&pt(t,a(a({},{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!0,caption_text:"",allow_ads:!0,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1,class_list_default:"image-full-gray"}),e))}(t,n)}))}))},ne=function(t){var e=t.attr("class");return e&&/\bimage\b/.test(e)},ae=function(t){return function(e){for(var n=e.length,a=function(e){e.attr("contenteditable",t?"true":null)};n--;){var i=e[n];ne(i)&&(i.attr("contenteditable",t?"false":null),yt.each(i.getAll("figcaption"),a))}}};n.add("image",(function(t){!function(t){t.on("PreInit",(function(){t.parser.addNodeFilter("figure",ae(!0)),t.serializer.addNodeFilter("figure",ae(!1))}))}(t),function(t){t.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:te(t).open,onSetup:function(e){return t.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",e.setActive).unbind}}),t.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:te(t).open}),t.ui.registry.addContextMenu("image",{update:function(t){return tt(t)||"IMG"===t.nodeName&&!R(t)?["image"]:[]}})}(t),ee(t)}))}();